<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ›¡ï¸ é ç®—æ§åˆ¶ä¸­å¿ƒ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        /* --------------------------- å…¨åŸŸèˆ‡éœ“è™¹è®Šæ•¸ (çµ±ä¸€ç‰ˆæœ¬) --------------------------- */
        :root {
            --bg-dark: #0f1115;                      /* ä¸»è¦èƒŒæ™¯è‰² (æœ€æ·±) */
            --bg-secondary: #1e1e1e;                 /* æ¬¡è¦èƒŒæ™¯è‰² (ç”¨æ–¼å¡ç‰‡/è¡¨å–®) */

            --neon-blue: #a7d7ff;                    /* éœ“è™¹è— (ä¸»è¦é€£çµ/æ”¶å…¥) */
            --neon-pink: #ffb3cf;                    /* éœ“è™¹ç²‰ (æ”¯å‡º/å‰¯è‰²) */
            --neon-green: #a8f0c6;                   /* å„²å­˜/é ç®—ç¶  */
            --neon-yellow: #fff1a6;                  /* å¼·èª¿è‰²/è­¦ç¤º */
            --neon-red: #ff7f7f;                     /* åˆªé™¤/å±éšª */

            --text-light: #e6e6e6;                   /* æ–‡å­—æ·ºè‰² */
            --text-dark: #b8b8b8;                    /* æ–‡å­—æ·±è‰² */
            --border-color: #2a2a2a;                 /* é‚Šæ¡†é¡è‰² */

            /* åˆ†é¡é¡è‰²è®Šæ•¸ (å¯æ ¹æ“šæ‚¨çš„éœ€æ±‚èª¿æ•´) */
            --cat-1: #ff7f7f;
            --cat-2: #ffcc66;
            --cat-3: #a8f0c6;
            --cat-4: #a7d7ff;
            --cat-5: #ffb3cf;
            --cat-6: #cf9cff;
            --cat-7: #66ffcc;
            --cat-8: #ff9c66;
            --cat-9: #99ccff;
            --cat-10: #d4d4d4;
            --cat-11: #ffd1dc;
            --cat-12: #ffe066;
            --cat-13: #8affc1;
            --cat-14: #8ed1ff;
            --cat-15: #c9a7ff;
            --cat-16: #ffb380;
            --cat-17: #b3ffb3;
            --cat-18: #b3d9ff;
            --cat-19: #ffe6b3;
            --cat-20: #ffadad;
        }

        /* çµ±ä¸€çš„éœ“è™¹æ¨£å¼ */
        .neon-text {
            text-shadow: 0 0 5px var(--neon-blue), 0 0 10px var(--neon-blue);
            transition: text-shadow 0.3s;
        }
        .neon-pink-text {
            text-shadow: 0 0 5px var(--neon-pink), 0 0 10px var(--neon-pink);
            transition: text-shadow 0.3s;
        }
        .neon-shadow {
            box-shadow: 0 0 10px rgba(167, 215, 255, 0.3), 0 0 20px rgba(167, 215, 255, 0.1);
            transition: box-shadow 0.3s;
        }
        /* Active ç‹€æ…‹æŒ‰éˆ•çš„éœ“è™¹å…‰æšˆ */
        .active-neon-glow {
            box-shadow: 0 0 8px var(--neon-blue), 0 0 15px var(--neon-blue)50;
            border-color: var(--neon-blue) !important;
        }

        /* çµ±ä¸€ Font-Awesome åœ–æ¨™æ¨£å¼ */
        .fa, .fas, .far, .fab {
            margin-right: 5px;
        }

        body{
            margin:0;
            padding:20px;
            background:var(--bg-dark);
            font-family:'Segoe UI',sans-serif;
            color:var(--text-light);
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox (é›–ç„¶æ‚¨ä¸»è¦ä½¿ç”¨çš„æ˜¯ Webkit/MSï¼Œä½†çµ±ä¸€åŠ ä¸Š) */
        }

        /* --------------------------- éš±è—æ»¾å‹•æ¢ï¼šWebkit æ ¸å¿ƒç€è¦½å™¨ (Chrome, Safari) --------------------------- */
        /* é‡å°æ•´å€‹ body å…ƒç´  */
        body::-webkit-scrollbar {
            width: 0px;  /* éš±è—å‚ç›´æ»¾å‹•æ¢ */
            height: 0px; /* éš±è—æ°´å¹³æ»¾å‹•æ¢ */
        }

        body::-webkit-scrollbar,
        .content-container::-webkit-scrollbar,
        .category-list-container::-webkit-scrollbar {
            display: none;
            width: 0 !important;
            height: 0 !important;
        }

        /* 1. é‡å°æ‰€æœ‰å…ƒç´ ï¼ˆåŒ…å« body å’Œæ‰€æœ‰ divï¼‰éš±è—æ»¾å‹•æ¢ï¼Œä½†ä¿ç•™æ»¾å‹•åŠŸèƒ½ */
        * {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;     /* Firefox */
        }

        *::-webkit-scrollbar {
            display: none;             /* Chrome, Safari, Opera */
            width: 0 !important;
            height: 0 !important;
        }

        /* 2. ç¢ºä¿ html å’Œ body ä¹Ÿå®Œå…¨éš±è— */
        html, body {
            overflow: -moz-scrollbars-none;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        body::-webkit-scrollbar {
            display: none;
        }

        /* é‡å°éœ€è¦æ»¾å‹•çš„ç‰¹å®šå®¹å™¨ (å¦‚ä¸»è¦çš„å…§å®¹å€å¡Š) */
        .content-container::-webkit-scrollbar,
        .category-list-container::-webkit-scrollbar {
            width: 0px;
            height: 0px;
        }

        .container{max-width:900px;margin:auto;padding-bottom:80px;}

        h2{
            color:var(--neon-green);
            border-bottom:2px solid var(--bg-secondary);
            padding-bottom:12px;
            margin-bottom:25px;
            display:flex;
            align-items:center;
            gap:12px;
        }

        /* budget.html: ä¿®æ­£ .page-title */
        .page-title {
            color: var(--neon-blue);
            text-shadow: 0 0 10px var(--neon-blue);
            font-size: 1.8em;
            margin-bottom: 25px;
            padding-left: 10px;
        }

        /* budget.html: çµ±ä¸€ card æ¨£å¼ */
        .budget-card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            font-size: 1em; /* çµ±ä¸€å¡ç‰‡å…§æ–‡å­—é«”å¤§å° */
        }

        /* budget.html: é€²åº¦æ¢æ–‡å­—å¤§å° */
        .progress-text {
            font-size: 0.95em;
            font-weight: 500;
        }

        /* -------- ç¸½è¦½ -------- */
        .total-budget-card{
            background:linear-gradient(145deg,#1e1e1e,#252525);
            padding:25px;
            border-radius:20px;
            margin-bottom:30px;
            text-align:center;
        }
        .total-title{color:var(--text-dark);}
        .total-amount{font-size:2.6rem;font-weight:bold;margin:15px 0;}

        .progress-container{
            background:rgba(255,255,255,0.1);
            height:22px;
            border-radius:11px;
            overflow:hidden;
        }
        .progress-fill{
            height:100%;
            width:0%;
            transition:.5s;
            /* é€™è£¡ä¸å†ä½¿ç”¨ status-safe/warning/danger é¡ï¼Œè€Œæ˜¯ç›´æ¥åœ¨ JS ä¸­è¨­å®šèƒŒæ™¯è‰² */
        }
        .progress-text{
            display:flex;
            justify-content:space-between;
            margin-top:8px;
            color:var(--text-dark);
        }

        /* ç‹€æ…‹ */
        .status-safe{background:var(--neon-green);}
        .status-warning{background:var(--neon-yellow);}
        .status-danger{background:var(--neon-red);}
        .text-safe{color:var(--neon-green);}
        .text-warning{color:var(--neon-yellow);}
        .text-danger{color:var(--neon-red);}

        /* -------- åˆ†é¡å¡ç‰‡ -------- */
        .budget-list{
            display:grid;
            grid-template-columns:repeat(auto-fit,minmax(320px,1fr));
            gap:20px;
        }
        .budget-card{
            background:var(--bg-secondary);
            padding:20px;
            border-radius:16px;
        }
        .card-header{
            display:flex;
            justify-content:space-between;
            align-items:center;
            margin-bottom:12px;
        }
        .cat-info{display:flex;gap:12px;align-items:center;}
        .cat-icon{
            width:42px;height:42px;
            border-radius:50%;
            background:rgba(255,255,255,0.1);
            display:flex;
            align-items:center;
            justify-content:center;
        }
        .cat-name{font-size:1.25rem;font-weight:bold;}

        .budget-setter{
            text-align:right;
            cursor:pointer;
        }
        .budget-label{font-size:.8rem;color:var(--text-dark);}
        .budget-display{font-size:1.1rem;color:var(--neon-yellow);}
        .budget-input{
            display:none;
            width:90px;
            background:#000;
            color:#fff;
            border:1px solid #555;
            padding:4px;
            text-align:right;
        }

        .card-stats{
            display:flex;
            justify-content:space-between;
            margin-top:8px; /* èª¿æ•´ç‚º card-statsï¼Œå› ç‚ºé€²åº¦æ¢å¾ŒåŸæœ¬æœ‰ progress-text */
            color:var(--text-dark);
        }

        .toast{
            position:fixed;
            bottom:30px;
            left:50%;
            transform:translateX(-50%);
            background:var(--neon-green);
            color:#000;
            padding:10px 20px;
            border-radius:20px;
            font-weight:bold;
            opacity:0;
            transition:.3s;
            z-index: 1000;
        }

        /* å­åˆ†é¡å®¹å™¨ - é è¨­éš±è— */
        .sub-category-container {
            display: none;
            margin-left: 15px;
            padding-left: 10px;
            border-left: 2px dashed var(--bg-secondary);
            margin-top: 10px;
        }

        /* å±•é–‹ç‹€æ…‹ */
        .sub-category-container.active {
            display: block;
        }

        /* æ—‹è½‰ç®­é ­ */
        .expand-icon {
            transition: transform 0.3s ease;
            margin-left: 10px;
            font-size: 0.8em;
            cursor: pointer;
        }

        .expanded .expand-icon {
            transform: rotate(180deg);
        }

        /* è®“ä¸»åˆ†é¡å¡ç‰‡çœ‹èµ·ä¾†å¯ä»¥é»æ“Š */
        .main-budget-card {
            cursor: pointer;
            transition: background 0.2s;
        }
        .main-budget-card:hover {
            background: rgba(255, 255, 255, 0.05);
        }
    </style>

</head>

<body>
    <div class="container">
        <h1 class="page-title neon-text"><i class="fas fa-shield-alt"></i> é ç®—æ§åˆ¶ä¸­å¿ƒ</h1>

        <div class="total-budget-card">
            <div class="total-title">æœ¬æœˆç¸½é ç®—å‰©é¤˜</div>
            <div class="total-amount" id="totalRemaining">$0</div>
            <div class="progress-container">
                <div class="progress-fill" id="totalBar"></div> 
            </div>
            <div class="progress-text">
                <span id="totalSpentText">å·²èŠ± $0</span>
                <span id="totalBudgetText">ç¸½é ç®— $0</span>
            </div>
        </div>

        <div class="budget-list" id="budgetList"></div>

        <div id="noBudgetMsg" style="text-align: center; color: var(--text-dark); padding: 50px 0; display: none;">
            <i class="fas fa-hand-pointer fa-3x" style="color: var(--neon-pink); margin-bottom: 15px;"></i>
            <h3>æ²’æœ‰é ç®—æˆ–äº¤æ˜“ç´€éŒ„</h3>
            <p>è«‹åˆ° <a href="#" onclick="if (window.parent && typeof window.parent.switchPage === 'function') { window.parent.switchPage(null, 'settings.html'); }">è¨­å®šé é¢</a> æˆ– <a href="#" onclick="if (window.parent && typeof window.parent.switchPage === 'function') { window.parent.switchPage(null, 'recordpage.html'); }">è¨˜å¸³é é¢</a> è¨­å®šåˆ†é¡å¾Œï¼Œç›´æ¥åœ¨ä¸‹æ–¹åˆ†é¡è¨­å®šé ç®—ã€‚</p>
        </div>


    </div>

    <div class="toast" id="toast">å·²æ›´æ–°é ç®—</div>

</body>

    <script>
        /* ===============================
        Budget Page - JS (å…¨æ–¹ä½åŒæ­¥ç‰ˆ)
        =============================== */

        const TRANSACTION_STORAGE_KEY = 'transactions';
        const BUDGET_STORAGE_KEY = 'budget_settings';
        const CATEGORY_STORAGE_KEY = 'categoryData';
        const CURRENCY_KEY = 'app_currency';

        // ---------- é è¨­åˆ†é¡ (è§£æ±ºé€²ä¾†æ²’æ±è¥¿çš„å•é¡Œ) ----------
        function getDefaultCategories() {
            return {
                expense: [
                    { id: 1, name: "é¤é£²", icon: "fas fa-utensils", color: "var(--cat-1)", sub: [
                        { id: 101, name: "å¤–é£Ÿ", icon: "fas fa-burger", color: "var(--cat-1)" },
                        { id: 102, name: "é£²å“", icon: "fas fa-coffee", color: "var(--cat-1)" },
                        { id: 103, name: "é›¶é£Ÿ", icon: "fas fa-cookie-bite", color: "var(--cat-1)" },
                    ]},
                    { id: 2, name: "äº¤é€š", icon: "fas fa-bus", color: "var(--cat-2)", sub: [
                        { id: 201, name: "æ²¹è³‡/å……é›»", icon: "fas fa-gas-pump", color: "var(--cat-2)" },
                        { id: 202, name: "å…¬è»Š/æ·é‹", icon: "fas fa-subway", color: "var(--cat-2)" },
                        { id: 203, name: "è¨ˆç¨‹è»Š", icon: "fas fa-taxi", color: "var(--cat-2)" },
                    ]},
                    { id: 3, name: "è³¼ç‰©", icon: "fas fa-shopping-bag", color: "var(--cat-3)", sub: [
                        { id: 301, name: "æœé£¾", icon: "fas fa-shirt", color: "var(--cat-3)" },
                        { id: 302, name: "æ—¥ç”¨å“", icon: "fas fa-toilet-paper", color: "var(--cat-3)" },
                        { id: 303, name: "3C ç”¢å“", icon: "fas fa-mobile-screen-button", color: "var(--cat-3)" },
                    ]},
                    { id: 4, name: "å¨›æ¨‚", icon: "fas fa-gamepad", color: "var(--cat-4)", sub: [
                        { id: 401, name: "é›»å½±/å±•è¦½", icon: "fas fa-ticket", color: "var(--cat-4)" },
                        { id: 402, name: "éŠæˆ²", icon: "fas fa-dice", color: "var(--cat-4)" },
                        { id: 403, name: "æ—…éŠ", icon: "fas fa-plane", color: "var(--cat-4)" },
                    ]},
                    { id: 5, name: "å±…ä½", icon: "fas fa-home", color: "var(--cat-5)", sub: [
                        { id: 501, name: "æˆ¿ç§Ÿ/æˆ¿è²¸", icon: "fas fa-building-columns", color: "var(--cat-5)" },
                        { id: 502, name: "æ°´é›»ç“¦æ–¯", icon: "fas fa-lightbulb", color: "var(--cat-5)" },
                        { id: 503, name: "ç¶²è·¯/é›»ä¿¡", icon: "fas fa-signal", color: "var(--cat-5)" },
                    ]}
                ],
                income: []
            };
        }

        // ---------- è³‡æ–™è®€å–å·¥å…· ----------
        function getCurrencySymbol() {
            const stored = localStorage.getItem(CURRENCY_KEY);
            if (!stored) return '$';
            try {
                return JSON.parse(stored).symbol || '$';
            } catch(e) { return '$'; }
        }

        // å–å¾—ç›®å‰è¨­å®šçš„åŒ¯ç‡
        function getCurrencyRate() {
            const stored = localStorage.getItem(CURRENCY_KEY);
            if (!stored) return 1;
            try {
                const config = JSON.parse(stored);
                // å‡è¨­ä½ çš„è¨­å®šé æœ‰å­˜åŒ¯ç‡ (rate)ï¼Œå¦‚æœæ²’æœ‰ï¼Œå¯ä»¥è‡ªå®šç¾©ç°¡å–®çš„è¡¨
                const rates = { 'TWD': 1.0, 'USD': 0.032, 'JPY': 4.6, 'EUR': 0.029 };
                return rates[config.base] || 1;
            } catch(e) { return 1; }
        }

        function getCategoryData() {
            const stored = localStorage.getItem(CATEGORY_STORAGE_KEY);
            if (stored) {
                try {
                    const data = JSON.parse(stored);
                    if (data.expense && data.expense.length > 0) return data;
                } catch(e) {}
            }
            return getDefaultCategories(); // æ²’è³‡æ–™å°±æŠ“é è¨­
        }

        function getTransactions() {
            const stored = localStorage.getItem(TRANSACTION_STORAGE_KEY);
            try { return stored ? JSON.parse(stored) : []; } catch(e) { return []; }
        }

        function getBudgetSettings() {
            const stored = localStorage.getItem(BUDGET_STORAGE_KEY);
            return stored ? JSON.parse(stored) : {};
        }

        // ---------- æ ¸å¿ƒæ¸²æŸ“åŠŸèƒ½ ----------
        function renderBudget() {
            const TRANSACTIONS = getTransactions();
            const BUDGET_SETTINGS = getBudgetSettings();
            const CATEGORY_DATA = getCategoryData();
            const symbol = getCurrencySymbol(); // â­ï¸ æŠ“å¹£åˆ¥

            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            
            const expenseCategories = CATEGORY_DATA.expense || [];

            // è¨ˆç®—æ”¯å‡º
            const monthlyTransactions = TRANSACTIONS.filter(t => {
                const date = new Date(t.date);
                return date.getMonth() === currentMonth && date.getFullYear() === currentYear && t.type === 'expense';
            });

            // åœ¨ renderBudget è£¡é¢
            const actualExpense = monthlyTransactions.reduce((acc, t) => {
                const fullCatName = t.category || t.categoryText || 'æœªåˆ†é¡';
                
                // â­ï¸ é—œéµæ”¹å‹•ï¼šä¸è¦ç›´æ¥ç”¨ t.amountï¼Œè¦ç”¨ baseAmount ä¹˜ä»¥ç›®å‰çš„åŒ¯ç‡
                // å‡è¨­ä½ çš„è¨­å®šæª”è£¡æœ‰å­˜ rateï¼Œå¦‚æœæ²’æœ‰ï¼Œæˆ‘å€‘é è¨­ç‚º 1
                const currentRate = getCurrencyRate(); 
                const amount = (parseFloat(t.baseAmount) || parseFloat(t.amount) || 0) * currentRate;
                
                acc[fullCatName] = (acc[fullCatName] || 0) + amount;
                
                if (fullCatName.includes(' / ')) {
                    const mainCatName = fullCatName.split(' / ')[0];
                    acc[mainCatName] = (acc[mainCatName] || 0) + amount;
                }
                return acc;
            }, {});

            const container = document.getElementById('budgetList');
            if (!container) return;
            container.innerHTML = '';

            let totalBudget = 0;
            let totalSpent = 0;

            expenseCategories.forEach((mainCat, index) => {
                const spent = actualExpense[mainCat.name] || 0;
                const budget = BUDGET_SETTINGS[mainCat.name] || 0;
                totalBudget += budget;
                totalSpent += spent;

                const hasSubs = mainCat.sub && mainCat.sub.length > 0;
                const mainCardHtml = createCardHtml(mainCat.name, mainCat.name, budget, spent, mainCat.color, mainCat.icon, false, hasSubs, index, symbol);
                
                let subCardsHtml = '';
                if (hasSubs) {
                    mainCat.sub.forEach(sub => {
                        const subFullName = `${mainCat.name} / ${sub.name}`;
                        const subSpent = actualExpense[subFullName] || 0;
                        const subBudget = BUDGET_SETTINGS[subFullName] || 0;
                        subCardsHtml += createCardHtml(subFullName, sub.name, subBudget, subSpent, mainCat.color, sub.icon || mainCat.icon, true, false, 0, symbol);
                    });
                }

                container.insertAdjacentHTML('beforeend', `
                    <div class="category-group">
                        ${mainCardHtml}
                        <div id="sub-container-${index}" class="sub-category-container">
                            ${subCardsHtml}
                        </div>
                    </div>
                `);
            });

            updateTotalDisplay(totalBudget, totalSpent, symbol);
        }

        function createCardHtml(saveKey, displayName, budget, spent, color, icon, isSub, hasSubs, index, symbol) {
            let progress = budget > 0 ? Math.min(100, (spent / budget) * 100) : (spent > 0 ? 100 : 0);
            let progressColor = progress >= 100 ? 'var(--neon-red)' : (progress > 80 ? 'var(--neon-yellow)' : color);

            const budgetDisplay = budget > 0 ? `${symbol}${budget.toLocaleString()}` : 'è¨­å®šé ç®—';
            const clickAction = !isSub && hasSubs ? `onclick="toggleSub(${index})"` : '';

            return `
                <div id="${!isSub ? 'main-card-'+index : ''}" class="budget-card ${!isSub ? 'main-budget-card' : ''}" ${clickAction}>
                    <div class="card-header">
                        <div class="cat-info">
                            <span class="cat-icon" style="color: ${color};"><i class="${icon}"></i></span>
                            <span class="cat-name" style="color: ${color}; font-size: ${isSub ? '0.9em' : '1.1em'};">
                                ${displayName}
                                ${!isSub && hasSubs ? '<i class="fas fa-chevron-down expand-icon"></i>' : ''}
                            </span>
                        </div>
                        <div class="budget-setter" onclick="event.stopPropagation(); editBudget(this)">
                            <div class="budget-label">é ç®—</div>
                            <div class="budget-display" style="color: ${budget > 0 ? 'var(--neon-yellow)' : 'var(--text-dark)'}">
                                ${budgetDisplay}
                            </div>
                            <input type="number" class="budget-input" value="${budget || ''}" 
                                onblur="saveBudget(this, '${saveKey}')"
                                onkeydown="if(event.key==='Enter') saveBudget(this,'${saveKey}')">
                        </div>
                    </div>
                    <div class="progress-container">
                        <div class="progress-fill" style="width:${progress}%; background-color:${progressColor};"></div>
                    </div>
                    <div class="card-stats">
                        <span>å·²èŠ± ${symbol}${spent.toLocaleString()}</span>
                        <span>${progress.toFixed(0)}%</span>
                    </div>
                </div>
            `;
        }

        function updateTotalDisplay(budget, spent, symbol) {
            const remain = budget - spent;
            const remainEl = document.getElementById('totalRemaining');
            if(remainEl) {
                remainEl.textContent = `${symbol}${remain.toLocaleString()}`;
                remainEl.style.color = remain >= 0 ? 'var(--neon-green)' : 'var(--neon-red)';
            }
            document.getElementById('totalSpentText').textContent = `å·²èŠ± ${symbol}${spent.toLocaleString()}`;
            document.getElementById('totalBudgetText').textContent = `ç¸½é ç®— ${symbol}${budget.toLocaleString()}`;
            
            const bar = document.getElementById('totalBar');
            if(bar) {
                let p = budget > 0 ? Math.min(spent/budget*100, 100) : 0;
                bar.style.width = `${p}%`;
                bar.style.backgroundColor = p >= 100 ? 'var(--neon-red)' : (p > 80 ? 'var(--neon-yellow)' : 'var(--neon-green)');
            }
        }

        // ---------- å…¶ä»–æ“ä½œ ----------
        function toggleSub(id) {
            document.getElementById(`sub-container-${id}`)?.classList.toggle('active');
            document.getElementById(`main-card-${id}`)?.classList.toggle('expanded');
        }

        function editBudget(el) {
            el.querySelector('.budget-display').style.display = 'none';
            const inp = el.querySelector('.budget-input');
            inp.style.display = 'block';
            inp.focus(); inp.select();
        }

        function saveBudget(input, key) {
            const settings = getBudgetSettings();
            const val = parseFloat(input.value);
            if(isNaN(val) || val <= 0) delete settings[key];
            else settings[key] = val;
            localStorage.setItem(BUDGET_STORAGE_KEY, JSON.stringify(settings));
            renderBudget();
            // é¡¯ç¤ºé€šçŸ¥
            const t = document.getElementById('toast');
            if(t) { t.style.opacity = 1; setTimeout(()=> t.style.opacity=0, 1000); }
        }

        // â­ï¸ é—œéµï¼šç›£è½æ‰€æœ‰è®Šå‹•
        window.addEventListener('storage', (e) => {
            if ([CURRENCY_KEY, CATEGORY_STORAGE_KEY, TRANSACTION_STORAGE_KEY, BUDGET_STORAGE_KEY].includes(e.key)) {
                renderBudget();
            }
        });

        document.addEventListener('DOMContentLoaded', renderBudget);
    </script>

</html>